<!doctype html>
<!--零售实操主页面-->
<html id="hl">
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/retail_operation.css"/>
		<script type="text/javascript" src="../js/zc_utils.js"></script>
		<style>
			body,html{
				position: fixed;
				overflow: hidden;
				width: 100%;
				height: 100%;
				background-color: #fff;
			}
			.loadWeb{
				position: fixed;
				z-index: 2;
				background-color: #454545;
				color: #fff;
				padding:10px 20px;
				border-radius: 8px;
			}
			.LoadMask{
				position: fixed;
				left: 0;
				top: 0;
				width: 100%;
				height: 100%;
				z-index: 1;
			}
			.mui-segmented-control.mui-scroll-wrapper .mui-control-item{
				margin-right: 0;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="height: 55px;">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="margin-top: 15px;padding-right: 30px;"></a>
			<h1 class="mui-title" style="margin-top: 15px;" id="page_title">认知迭代</h1>    
			<a href="#" id="search_start" style="position: absolute;right: 0;width: 40px;height: 55px;padding-right: 15px;"><img src="../img/retail_operation/icon_search.png" style="display:inline-block;float:right;margin-top:30px;height: 15px;"/></a>
		</header>

		<div id="search_Bar"><img src="../img/retail_operation/icon_search_1.png"/><input id="a" class="search" type="text" placeholder="搜索你感兴趣的内容"/><span class="search_cancel">取消</span><button id="searchBtn" class="search_button">搜索</button></div>

		<!--<div id="search_Bar"><img src="../img/retail_operation/icon_search_1.png"/><input id="a" class="search" type="text" placeholder="搜索你感兴趣的内容"/><span class="search_cancel" style="padding-top: 10px;padding-bottom: 10px;">取消</span><span class="search_button">搜索</span></div>-->

		<div class="mui-content" >
			<!-各个专栏  mui-progressbar-->
			<div id="courseSortDiv" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="height:50px;background-color: #fff;position: fixed;top:50px;">
				<div class="mui-scroll" id="title_background">			
					
				</div>
			</div>
			<!--各个专栏的内容-->	
			<div id="course_content_list" class="retail_operation_content" style="margin-top: 50px;">
				<!--生鲜专栏-->
				<div class="retail_operation_content1" id="retail_1" style="display: none;">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell mui-media">
							<div href="javascript:;" style="text-overflow: ellipsis; overflow: hidden;white-space: nowrap;">
								<img class="mui-media-object mui-pull-left" src="../img/retail_operation/def_1.png"style="height: 85px;max-width: 110px;padding-bottom:0px;">
								<div class="mui-media-body">
									<p class="font-first-line">当生鲜行业遇上互联网</p>
									<p class='mui-ellipsis-2 font-second-line'>根据用户需求为商品添加多城市覆盖，精确定到"省、市、区（县）",就近安排</p>
									<p>
									<img src="../img/retail_operation/icon_1.png" class="img-first-size"/>
									<span  class="font-third-size"  style="vertical-align: middle;">2017-05-08 </span>
									<img src="../img/retail_operation/icon_2.png" class="img-second-size"/>
									<span class="font-fourth-size">21003</span>
	                                                                <p>
								</div>
							</div>
						</li>
					</ul>
				<!--生鲜专栏的div-->
				</div>	
				<!--食品用品专栏-->
				<div class="retail_operation_content1" id="retail_2" style="display: none;">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../img/retail_operation/def_5.png"style="height: 85px;max-width: 110px;padding-bottom:0px;">
								<div class="mui-media-body">
									<p class="font-first-line">当生鲜行业遇上互联网</p>
									<p class='mui-ellipsis-2 font-second-line'>根据用户需求为商品添加多城市覆盖，精确定到"省、市、区（县）",就近安排</p>
									<img src="../img/retail_operation/icon_1.png" class="img-first-size"/>
									<h6  class="font-third-size">2017-05-08 </h6>
									<img src="../img/retail_operation/icon_2.png" class="img-second-size"/>
									<h6 class="font-fourth-size">21003</h6>
								</div>
							</a>
						</li>
					</ul>
				</div>	
				<!--餐饮加工专栏-->
				<div class="retail_operation_content1" id="retail_3" style="display: none;">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell mui-media">
							<a href="javascript:;">
								<img class="mui-media-object mui-pull-left" src="../img/retail_operation/def_3.png"style="height: 85px;max-width: 110px;padding-bottom:0px;">
								<div class="mui-media-body">
									<p class="font-first-line">当生鲜行业遇上互联网</p>
									<p class='mui-ellipsis-2 font-second-line'>根据用户需求为商品添加多城市覆盖，精确定到"省、市、区（县）",就近安排</p>
									<img src="../img/retail_operation/icon_1.png" class="img-first-size"/>
									<h6  class="font-third-size">2017-05-08 </h6>
									<img src="../img/retail_operation/icon_2.png" class="img-second-size"/>
									<h6 class="font-fourth-size">21003</h6>
								</div>
							</a>
						</li>
					</ul>
				</div>
				<!--公共分享专栏-->
				<div class="retail_operation_content1" id="retail_4"  style="display: none;">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell mui-media">
						<a href="javascript:;">
							<img class="mui-media-object mui-pull-left" src="../img/retail_operation/def_5.png"style="height: 85px;max-width: 110px;padding-bottom:0px;">
							<div class="mui-media-body">
								<p class="font-first-line">当生鲜行业遇上互联网</p>
								<p class='mui-ellipsis-2 font-second-line'>根据用户需求为商品添加多城市覆盖，精确定到"省、市、区（县）",就近安排</p>
								<img src="../img/retail_operation/icon_1.png" class="img-first-size"/>
								<h6  class="font-third-size">2017-05-08 </h6>
								<img src="../img/retail_operation/icon_2.png" class="img-second-size"/>
								<h6 class="font-fourth-size">21003</h6>
							</div>
						</a>
					</li>
				</ul>
			</div>	
			<!--各个专栏的内容-->	
			</div>	
		<!--对应mui-content的-->		
		</div>		
<!--页面加载弹窗-->
	<div class="loadWeb">加载中...</div>
	<div class="LoadMask"></div>								
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/jquery.min.js" ></script>
		<script type="text/javascript" src="../js/md5.js" ></script>
		<script type="text/javascript" src="../js/dateFormat.js" ></script>
		<script type="text/javascript">		
			mui.init();
			/*头部与状态栏一致的颜色*/
      		/*document.addEventListener('plusready',function(){
		        plus.navigator.setStatusBarBackground("#2768b7");
		  	},false);*/
		  		

		</script>
		<script type="text/javascript">
		var type = null;
		mui.plusReady(function() {
			plus.screen.lockOrientation("portrait-primary"); 
			var self = plus.webview.currentWebview();
			var csynopsis = null;
			var shareTitle = null;
			type = self.type;
//			var type = 3;
			var pageTitle = "认知迭代";
			switch(type){
				case 2:
					pageTitle = "案例中心";
					break;
				case 3:
					pageTitle = "专项推广";
					break;
				case 4:
					pageTitle = "营销在线";
					break;	
				default:
					break;
			}
			$("#page_title").html(pageTitle);
			
			var signData = {
				"type" : type,
				"token" : token,
				"timeInMillis" : getTimestamp()
			};
			var signature = getSignature(signData);
			var signature_md5 = md5(md5(signature));
			mui.post(externalSortAddress,{
				method:"query",
				type:type,
				token:token,
				timeInMillis:getTimestamp(),
				signature:signature_md5
			},function(data){
				if(data.result){;
					drawSort(data.data);
					csynopsis =	data.data.csynopsis;
					shareTitle = data.data.ctitle;
				}else{
					//服务器繁忙
				}
			},'json');
			
			function drawSort(courseSortList){
				var sortDiv = $("#title_background");
				mui.each(courseSortList,function(index,item){
					if(index == 0){
						getCourse(item.id);
						sortDiv.append("<a name=\"" + item.id + "\" class=\"mui-control-item mui-active\" style=\"font-size:14px;font-weight: 500;\">" + item.sname + "</a>");
						$("#title_background a").css("width","50vw");
					}else{
						sortDiv.append("<a name=\"" + item.id + "\" class=\"mui-control-item\" style=\"font-size:14px;font-weight: 500;\">" + item.sname + "</a>");
						if(index==1){
							$("#title_background a").css("width","40vw")
						}
						if(index==2){
							$("#title_background a").css("width","33vw")
						}
						if(index>2){
							$("#title_background a").css("width","25vw")
						}					
					}
				});
			}
			
			function getCourse(sid){
				signData = {
					"sid" : sid,
					"pageNo" : 1,
					"pageSize" : 99,
					"token" : token,
					"timeInMillis" : getTimestamp()
				};
				signature = getSignature(signData);
				signature_md5 = md5(md5(signature));
				mui.post(externalAddress,{
					method:"query",
					sid:sid,
					pageNo:1,
					pageSize:99,
					token:token,
					timeInMillis:getTimestamp(),
					signature:signature_md5
				},function(data){
					if(data.result){
						console.log(data.data);
						drawExternal(data.data, sid)
					}else{
						//服务器繁忙
					}
				},'json');
			}
			//生鲜专栏等点击事件
			/*$(function() {
                var t_li = $(".mui-control-item");
                var c_li = $(".retail_operation_content1");
                $("a").on("tap",function(){
                    var i = t_li.index($(this));
                    function way() {
                        t_li.removeClass("mui-active").eq(i).addClass("mui-active");
                        
                        c_li.hide().eq(i).show();
                    }
                    timer = setTimeout(way, 0);
                }, function() {
                    clearTimeout(timer);
                });
            });*/
			function drawExternal(externallist, sid){
				$("div[class=retail_operation_content1]").each(function(){
			    	$(this).hide();
			  	});
				var course_content_list = $("#course_content_list");
				if($("div[name=" + sid + "]").length > 0){
				  	$("div[name=" + sid + "]").show();
				}else{
					var t_li = $(".mui-control-item");
	                var c_li = $(".retail_operation_content1");
	                $("a").on("tap",function(){
	                    var i = t_li.index($(this));
	                    function way() {
	                        t_li.removeClass("mui-active").eq(i).addClass("mui-active");
	                        c_li.hide().eq(i).show();
	                    }
	                    timer = setTimeout(way, 0);
	                }, function() {
						var sortId = $(this).attr("name");
						getCourse(sortId);
	                });
					var course_content_list = $("#course_content_list");
					mui.each(externallist,function(index,item){						
						var retail_totalDiv=$("<div/>").addClass("retail_operation_content1").attr("name",item.id).click(function(){
							if(item.eftype == 1){
								mui.openWindow({
									url: 'show_external_content.html',
									id: 'show_external_content.html',
								extras:{
				       				eid:item.id,
				       				cover:item.ecover,
					      		    csynopsis:csynopsis,
					      		    shareTitle:shareTitle
					   				},
				   				waiting:{
			      					autoShow:true,//自动显示等待框，默认为true
				      				title:'正在加载...'//等待对话框上显示的提示内容
					   				}
								});
							}else if(item.eftype == 2){
								mui.openWindow({
									url: 'show_external_audio.html',
									id: 'show_external_audio.html',
								extras:{
				       				eid:item.id,
				       				cover:item.ecover,
				       				csynopsis:csynopsis,
					      		    shareTitle:shareTitle
					   				},
				   				waiting:{
			      					autoShow:true,//自动显示等待框，默认为true
				      				title:'正在加载...'//等待对话框上显示的提示内容
					   				}
								});
							}else{
								mui.openWindow({
									url: 'show_external_ppt.html',
									id:  'show_external_ppt.html',
								extras:{
				       				eid:item.id,
				       				cover:item.ecover,
				       				csynopsis:csynopsis,
					      		    shareTitle:shareTitle
					   				},
				   				waiting:{
			      					autoShow:true,//自动显示等待框，默认为true
				      				title:'正在加载...'//等待对话框上显示的提示内容
					   				}
								});
								
							}
						});
						var retail_ul=$("<ul>").addClass("mui-table-view");
						var retail_li=$("<li/>").addClass("mui-table-view-cell mui-media");
						var retail_wrapDiv = $("<div/>").attr("href","javascript:openContent()").addClass("contentOut");
						var retail_Img = $("<img/>")
					 	.addClass('mui-media-object mui-pull-left')
					 	.attr("src",imageAddress + item.ecover)
					 	.css({
					 		height:"75px",
					 		width:"125px",
					 		maxWidth: "125px",
					 		paddingBottom:"0px",
					 	});
//					 	价格样式
//					 	var retail_prdiv=$("<div/>").addClass('class_price_out');
//					 	var retail_primg=$("<img>").attr("src","../img/retail_operation/icon_02.png");
//					 	var retail_prdivPe=$("<div/>").addClass("class_price_pre").html("原价1.99");
//					 	var retail_prdivNow=$("<div/>").addClass("class_price_now").html("0.00");
//					 	var retail_prspan=$("<span/>").addClass("money_logo").html("￥");
						 /*div包含3个p标签*/
					 	var retail_rDiv = $("<div/>").addClass('mui-media-body');
					 	var retail_pTitle = $("<p/>").addClass('font-first-line').html(item.etitle);
					 	var retail_pContent = $("<p/>").addClass('mui-ellipsis-2 font-second-line');
					 	retail_rDiv.append(retail_pTitle).append(retail_pContent);
						/*最后一个p标签分别包含2个img和2个span*/
					 	var retail_pChunk = $("</p>").addClass("TimeStyle");
					 	var retail_iconImg1 = $("<img/>").addClass('img-first-size').attr("src","../img/retail_operation/icon_1.png");
					 	var retail_tt = new Date(item.ecreateTime);
					 	var retail_time = $("<span/>").addClass('font-third-size').css({verticalAlign:"middle"}).html(retail_tt.Format("yyyy-MM-dd hh:mm:ss"));
					 	var retail_iconImg2 = $("<img/>").addClass('img-second-size').attr("src","../img/retail_operation/icon_2.png");
					 	var retail_num=$("<span/>").addClass('font-fourth-size').html(item.ctr);
					 	retail_pChunk.append(retail_iconImg1).append(retail_time).append(retail_iconImg2).append(retail_num);
					 	retail_rDiv.append(retail_pChunk);
					 	
//					 	retail_prdivNow.append(retail_prspan);
//					 	retail_prdiv.append(retail_primg).append(retail_prdivPe).append(retail_prdivNow);
//					 	retail_wrapDiv.append(retail_prdiv);
					 	
					 	retail_wrapDiv.append(retail_Img);
					 	retail_wrapDiv.append(retail_rDiv);
					 	retail_li.append(retail_wrapDiv);
						retail_ul.append(retail_li);
						retail_totalDiv.append(retail_ul);
						course_content_list.append(retail_totalDiv);
					});
				}
			}
		});
//			搜索行

			document.getElementById("search_start").addEventListener('tap',function(){
				$(".mui-bar,.mui-content,.mui-scroll-wrapper,.retail_operation_content").css("display","none");
				$("#search_Bar").css("display","flex");
				$(".mui-content").css("padding-top","0");
			});
			document.getElementsByClassName("search_cancel")[0].addEventListener('tap',function(){
				$(".mui-bar,.mui-content,.mui-scroll-wrapper,.retail_operation_content").css("display","block");
				$(".mui-content").css("padding-top","44px");
				$("#search_Bar").css("display","none");
				$(".search").blur();

			});
			$(document).ready(function(){
				$(".search").bind("input porpertychange",function(){ 
					var search_val=$(".search").val();
					if(search_val!==""){
						$(".search_button").css("display","block");
						$(".search_cancel").css("display","none");
					}else{
						$(".search_button").css("display","none");
						$(".search_cancel").css("display","block");
					}
				})
			});
//		判断图片是否加载完毕
		$(document).ready(function(){
			var screenWidth=$(window).width();
			var screenHeight=$(window).height();
			var loadWidth=$(".loadWeb").width();
			var loadHeight=$(".loadWeb").height();
			var width_Gap=(screenWidth-loadWidth)/2-20;
			var height_Gap=(screenHeight-loadHeight)/2;
			$(".loadWeb").css({"left":width_Gap,"top":height_Gap});
		})
		var Time_ing=setInterval(function(){
			var a=document.getElementsByClassName("mui-media")[0].getElementsByTagName("img")[0].complete;
			if(a){
				$(".LoadMask").css("display","none");
				$(".loadWeb").css("display","none");
				$("body,html").css({"position":"absolute","overflow":"visible","height":"auto"});
				clear_time()
			}
		},500)
		function clear_time(){
			clearInterval(Time_ing);
		}
//		搜索
		document.getElementById("searchBtn").addEventListener('tap',function(){		
				var text = $("#a").val();
				mui.post(searchAddress,{
					method:"queryExternal",
					type : type,
					content : text
				},function(data){
					if(data.result){
						mui.openWindow({
							url: '../external/search_external.html',
							id: 'search_external.html',
							extras:{
			       				 extList:data.data,
			       				 type : type
			   				},
			   				waiting:{
		      					autoShow:true,
			      				title:'正在加载...'
			   				}						
						});
				//	alert(data.data);
					}
				$(".search_button").css("display","none");
				$(".search_cancel").css("display","block");
				$(".mui-bar,.mui-content,.mui-scroll-wrapper,.retail_operation_content").css("display","block");
				$(".mui-content").css("padding-top","44px");
				$("#search_Bar").css("display","none");
				},'json')
				$(".search").val("");
		});
		</script>
	</body>

</html>